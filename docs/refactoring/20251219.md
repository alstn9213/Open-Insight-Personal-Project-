# 🛠️ Refactoring Report: 데이터 신뢰성 확보를 위한 서비스 수정

## 1. 개요 (Overview)

### 🚨 기존 문제점 (Problem)

1. **데이터 신뢰성 부족:** 초기 기획에서 매출, 폐업률 등을 예측하기 위해 난수(Random) 로직을 사용했으나, 이는 사용자에게 잘못된 정보를 제공할 위험이 있으며 서비스의 진정성을 저해함.
2. **분석 단위의 한계:** '구(District)' 단위의 분석은 창업 입지를 선정하기에 너무 광범위하여 실질적인 도움이 되지 않음.
3. **복잡한 UX:** 가중치 조절(Slider) 기능은 사용자에게 불필요한 인지 부하를 주며, 모호한 예측 점수를 산출함.

### 🎯 개선 목표 (Goal)

* **Prediction → Analysis:** 불확실한 '예측' 기능을 제거하고, 팩트 기반의 '현황 분석' 대시보드로 전환.
* **Key Metric 변경:** 가상 점수 대신 **`점포당 유동인구(Population Per Store)`**라는 객관적 밀도 지표 도입.
* **단위 세분화:** 행정동(Town) 단위로 분석 범위를 좁혀 구체적인 입지 정보 제공.

---

## 2. 주요 변경 사항 (Key Changes)

### 🔄 A. 서비스 컨셉 및 핵심 지표

| 구분 | 변경 전 (Before) | **변경 후 (After)** |
| --- | --- | --- |
| **서비스 성격** | 창업 성공률 **예측** 및 추천 | 상권 밀도 및 경쟁 **현황 분석** |
| **핵심 알고리즘** | 랜덤 가중치 기반 Scoring | **공급(점포) 대비 수요(유동인구) 분석** |
| **주요 지표** | 순성장률 (Net Growth Rate) | **점포당 유동인구 (Population Per Store)** |
| **랭킹 기준** | 사용자 지정 가중치 종합 점수 | **틈새시장(기회) vs 격전지(과열) 정렬** |

### 💻 B. Backend (Spring Boot)

#### 1. DTO 구조 개선

복잡한 가중치 옵션을 제거하고, 명확한 정렬 기준(`SortOption`)을 도입했습니다.

* **Request:** `WeightOption`(가중치) 삭제 → **`SortOption` Enum** 추가
```java
public enum SortOption {
    OPPORTUNITY,    // 💎 틈새시장 (점포당 인구수 High)
    OVERCROWDED,    // 🔥 경쟁과열 (점포당 인구수 Low)
    POPULATION,     // 🏃 유동인구 순
    STORE_COUNT     // 🏪 점포 수 순
}

```


* **Response:** 예측 점수 필드 삭제 → **팩트 데이터(밀도)** 필드 추가
```java
// StartupRankingResponse.java
public record StartupRankingResponse(
    String regionName,
    int storeCount,            // 경쟁 업체 수 (Fact)
    int floatingPopulation,    // 유동인구 (Fact)
    double populationPerStore, // ★ 핵심 지표 (Density)
    String badge               // 직관적 뱃지 (ex: "기회", "과열")
) {}

```


#### 2. Service 로직 단순화

불투명한 연산 로직을 제거하고, Java Stream API를 활용한 정렬 로직으로 대체하여 유지보수성을 높였습니다.

```java
// MarketAnalysisService.java
public List<StartupRankingResponse> getMarketRankings(MarketAnalysisRequest request) {
    // ...
    // 복잡한 수식 제거 후 정렬(Sorting) 중심 로직으로 변경
    return allStats.stream()
        .sorted((s1, s2) -> Double.compare(getPopPerStore(s2), getPopPerStore(s1))) 
        .map(...)
        .toList();
}

```

#### 3. Controller 명세 변경

* `recommendStartups` → **`getMarketRankings`**: 메서드명을 직관적으로 변경하여 API의 역할을 명확히 함.

---

### 🎨 C. Frontend (React/TypeScript)

#### 1. 랭킹 페이지 (Ranking.tsx) UX 개선

* **복잡성 제거:** 사용자가 이해하기 힘든 '가중치 슬라이더' UI 삭제.
* **탭(Tab) UI 도입:** `💎 틈새시장 Top 10` / `🔥 격전지 Top 10` 탭을 통해 사용자가 원하는 정보를 즉시 조회 가능하도록 개선.
* **시각화:** 순위(Rank)를 Index 기반으로 자동 산정하고, 핵심 지표(점포당 인구수)를 강조하는 UI 구현.

#### 2. 지도 시각화 (AnalysisMap.tsx) 재정의

* **범례(Legend) 의미 변경:**
* 🟢 (기존) 성장률 높음 → **(변경) 공급 부족 (기회/유망)**
* 🔴 (기존) 성장률 낮음 → **(변경) 공급 과잉 (위험/포화)**



---

## 3. 기대 효과 (Expected Outcomes)

1. **데이터 신뢰성 확보 (Reliability):**
* 공공데이터 원천 값을 가공 없이(또는 투명한 나눗셈만으로) 보여주므로, 데이터 위조/조작 논란을 원천 차단했습니다.


2. **의사결정 보조 도구로서의 가치 상승:**
* "이거 하세요"라는 무책임한 추천 대신, "현재 경쟁 상황이 이렇습니다"라는 판단 근거를 제공하여 창업자가 스스로 의사결정을 내릴 수 있도록 돕습니다.


3. **개발 및 유지보수 효율성:**
* 백엔드 연산 로직이 단순해지면서 테스트가 용이해졌고, 프론트엔드 상태 관리 복잡도가 감소했습니다.



---

## 4. 향후 과제 (Next Step)

* **ETL 파이프라인 고도화:** 현재 구 단위로 수집되는 데이터를 '행정동' 단위로 매핑하는 Python 스크립트 정교화 작업 필요.
* **대용량 처리 최적화:** 랭킹 조회 시 전체 데이터를 메모리에 올리는 현재 방식을 개선하기 위해 DB 레벨의 Paging 또는 Indexing 적용 고려.